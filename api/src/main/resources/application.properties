# Application Configuration
quarkus.application.name=maestro-api
quarkus.application.version=#{project.version}

# HTTP Configuration
quarkus.http.port=8080

# Test HTTP Configuration - use random ports during tests to avoid conflicts
quarkus.http.test-port=0
quarkus.http.test-ssl-port=0

# REST Configuration - Enable YAML content type
quarkus.rest.media-types=application/x-yaml,application/yaml

# Logging Configuration
quarkus.log.level=INFO
quarkus.log.category."io.maestro".level=INFO

# Database Configuration
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=${DB_USERNAME:maestro}
quarkus.datasource.password=${DB_PASSWORD:maestro}
#quarkus.datasource.jdbc.url=${DB_URL:jdbc:postgresql://localhost:5432/maestro}

# Connection Pooling (Agroal configuration)
quarkus.datasource.jdbc.max-size=16
quarkus.datasource.jdbc.min-size=2
quarkus.datasource.jdbc.acquisition-timeout=10
quarkus.datasource.jdbc.leak-detection-interval=5M
quarkus.datasource.jdbc.idle-removal-interval=5M
quarkus.datasource.jdbc.max-lifetime=30M
quarkus.datasource.jdbc.transaction-isolation-level=read-committed
quarkus.datasource.jdbc.detect-statement-leaks=true

# Liquibase Configuration
# Load changelog from postgres module resources
quarkus.liquibase.change-log=db/changelog/db.changelog-master.xml
# Run migrations automatically on startup (set to false for production)
quarkus.liquibase.migrate-at-start=true
# Validate changelog on startup
quarkus.liquibase.validate-on-migrate=true
# Clean database on startup (WARNING: only for development, removes all data!)
quarkus.liquibase.clean-at-start=false

# JDBI Configuration (for postgres-repository plugin)
quarkus.jdbi.install-plugins=true

# Frontend Configuration
# Serve static resources from META-INF/resources (built React app)
quarkus.http.enable-compression=true
quarkus.http.cors=true
quarkus.http.cors.origins=http://localhost:5173
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=Content-Type,Authorization,Accept
quarkus.http.cors.exposed-headers=Location

# Index page configuration - serve index.html for non-API routes
quarkus.quinoa.enable-spa-routing=true

# OpenAPI/Swagger Configuration
quarkus.smallrye-openapi.path=/openapi
quarkus.swagger-ui.path=/swagger-ui
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.title=Maestro Workflow Management API
mp.openapi.extensions.smallrye.info.title=Maestro Workflow Management API
mp.openapi.extensions.smallrye.info.version=1.0.0
mp.openapi.extensions.smallrye.info.description=API for creating, versioning, and managing workflow definitions
mp.openapi.extensions.smallrye.info.contact.name=Maestro Team
mp.openapi.extensions.smallrye.info.license.name=Apache 2.0

# Container Image Configuration
quarkus.container-image.builder=jib
quarkus.container-image.group=#{project.groupId}
quarkus.container-image.name=#{project.artifactId}
quarkus.container-image.build=true
quarkus.container-image.tag=${quarkus.application.version}
quarkus.container-image.additional-tags=latest
quarkus.jib.base-jvm-image=eclipse-temurin:21-jre-alpine
quarkus.jib.platforms=linux/amd64,linux/arm64
